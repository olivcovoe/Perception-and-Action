---
title: "PA Exam"
author: "Arina Ljastsenko"
date: "2025-12-19"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Part I
Load data
```{r}
library(ggplot2)
data = read.csv('PA_data.csv')
```


Participants' info
```{r}
#Checking participants' information
sd_age <- sd(data$age)
mean_age <- mean(data$age)

# Count number of each gender
library(dplyr)
data %>% group_by(sex) %>% summarise(count = n())
```


Part II: Organizing data
```{r}
# Make 10-15 values into one value
library(stringr)

new_data <- data %>%
  mutate(est_time = ifelse(
    grepl("-", est_time),
    floor((as.numeric(sub("-.*", "", est_time)) + 
           as.numeric(sub(".*-", "", est_time)) + 1)/2),
    as.numeric(est_time)
  ))   
```

Creating new dfs with minimal values and maximal values
```{r}
#Minimal values df
library(readr)

new_data_min <- data %>%
  mutate(est_time = ifelse(
    grepl("-", est_time),
    parse_number(sub("-.*", "", est_time)),  # take the first number
    parse_number(est_time)
  ))

#Maximal values df
new_data_max <- data %>%
  mutate(est_time = ifelse(
    grepl("-", est_time),
    parse_number(sub(".*-", "", est_time)),  # take the second number
    parse_number(est_time)
  ))
new_data_max
```

```{r}
#Calculate estimation error and absolute error
new_data$estimation_error <- new_data$est_time - new_data$actual_time
new_data$absolute_error <- abs(new_data$estimation_error)

new_data_min$estimation_error <- new_data_min$est_time - new_data_min$actual_time
new_data_min$absolute_error <- abs(new_data_min$estimation_error)

new_data_max$estimation_error <- new_data_max$est_time - new_data_max$actual_time
new_data_max$absolute_error <- abs(new_data_max$estimation_error)

# Ensure the variables are factors
new_data$Condition <- factor(new_data$Condition, levels = c("pro", "retro"))
new_data$habitual_use <- factor(new_data$habitual_use, levels = c("low: <1h", "medium: 1-3h", "high: >3h"))
```

Plotting data
```{r}
#Plot data

library(ggplot2)

p1 <- ggplot(new_data, aes(x = estimation_error, fill = Condition)) +
  geom_histogram(alpha = 0.5, position = "identity", bins = 30) +
  labs(title = "Histogram of Estimation Errors", x = "Estimation Error (min)", y = "Count") +
  theme_minimal()
p1

# Boxplot by condition
p2 <- ggplot(new_data, aes(x = Condition, y = estimation_error, fill = Condition)) +
  geom_boxplot() +
  labs(title = "Estimation Error by Condition", x = "Condition", y = "Estimation Error (min)") +
  theme_minimal()
p2

# Boxplot by social media usage
p3 <- ggplot(new_data, aes(x = habitual_use, y = estimation_error, fill = habitual_use)) +
  geom_boxplot() +
  labs(title = "Estimation Error by Social Media Usage", x = "Social Media Usage", y = "Estimation Error (min)") +
  theme_minimal()
p3

# Scatter plot vs immersion
p4 <- ggplot(new_data, aes(x = immersion, y = estimation_error, color = Condition)) +
  geom_jitter(width = 0.2, height = 0) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Estimation Error vs Immersion", x = "Immersion Level", y = "Estimation Error (min)") +
  theme_minimal()
p4
```

```{r}
#Checking the direction and accuracy differences of conditions
t.test(estimation_error ~ Condition, data = new_data)
t.test(absolute_error ~ Condition, data = new_data)

# Visualizing
ggplot(new_data, aes(x = Condition, y = estimation_error, fill = Condition)) +
  geom_boxplot(alpha = 0.6, outlier.color = "red") +
  labs(title = "Estimation Error by Condition",
       x = "Condition",
       y = "Estimation Error (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")
```


```{r}
#Checking the variance difference
library(car)
leveneTest(absolute_error ~ Condition, data = new_data)
```


Part III: Models
```{r}
model1 <- lm(estimation_error ~ Condition + immersion + habitual_use, data = new_data)

#Checking the minimal and maximal values
model1_min <- lm(estimation_error ~ Condition + immersion + habitual_use, data = new_data_min)
model1_max <- lm(estimation_error ~ Condition + immersion + habitual_use, data = new_data_max)

#Check assumptions
summary(model1)
plot(model1)
shapiro.test(residuals(model1))

install.packages('lmtest')
library(lmtest)
dwtest(model1)
vif(model1)

summary(model1_min)
summary(model1_max)
```


```{r}
#Trying to make simpler model - model_immersion
model_immersion <- lm(estimation_error ~ Condition + immersion, data = new_data)

#Checking the minimal and maximal values
model_immersion_min <- lm(estimation_error ~ Condition + immersion, data = new_data_min)
model_immersion_max <- lm(estimation_error ~ Condition + immersion, data = new_data_max)


#Check assumptions for model_immersion
summary(model_immersion)
plot(model_immersion)
shapiro.test(residuals(model_immersion))
dwtest(model_immersion)
vif(model_immersion)

summary(model_immersion_min)
summary(model_immersion_max)
```

```{r}
anova(model_immersion, model1)
```

```{r}
model_immersion_interaction <- lm(estimation_error ~ Condition * immersion, data = new_data)

model_immersion_interaction_min <- lm(estimation_error ~ Condition * immersion, data = new_data_min)
model_immersion_interaction_max <- lm(estimation_error ~ Condition * immersion, data = new_data_max)

summary(model_immersion_interaction)
summary(model_immersion_interaction_min)
summary(model_immersion_interaction_max)
```

```{r}
model_abs <- lm(absolute_error ~ Condition + immersion, data = new_data)
summary(model_abs)
```


```{r}
library(ggplot2)

# Create a sequence of immersion values
imm_seq <- seq(min(new_data$immersion), max(new_data$immersion), length.out = 100)

# Create a new data frame for prediction
new_df <- expand.grid(
  Condition = unique(new_data$Condition),
  immersion = imm_seq
)

# Get predicted values and confidence intervals
pred <- predict(model_immersion, newdata = new_df, interval = "confidence")
new_df$fit <- pred[, "fit"]
new_df$lwr <- pred[, "lwr"]
new_df$upr <- pred[, "upr"]

# Plot
ggplot(new_df, aes(x = immersion, y = fit, color = Condition, fill = Condition)) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.2, color = NA) +
  labs(
    x = "Immersion Level",
    y = "Predicted Estimation Error (minutes)",
    color = "Condition",
    fill = "Condition",
    title = "Predicted Time Estimation Error by Condition and Immersion"
  ) +
  theme_minimal()
```


